<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="ACTIVITY" height="4361px" preserveAspectRatio="none" style="width:15167px;height:4361px;background:#FFFFFF;" version="1.1" viewBox="0 0 15167 4361" width="15167px" zoomAndPan="magnify"><title>Sprint 3: Refund Processing Flow with Validation</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="608.3516" x="7278.0992" y="35.4209">Sprint 3: Refund Processing Flow with Validation</text></g><rect fill="#FFFFFF" height="20.9531" style="stroke:#FFFFFF;stroke-width:1;" width="15144.55" x="10" y="54.3545"/><ellipse cx="899.5688" cy="90.3076" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1;"/><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="179.9902" x="809.5737" y="120.3076"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="159.9902" x="819.5737" y="141.4463">Navigate to invoice details</text><path d="M377.6641,272.2139 L377.6641,887.5264 L820.688,887.5264 L820.688,282.2139 L810.688,272.2139 L377.6641,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M810.688,272.2139 L810.688,282.2139 L820.688,282.2139 L810.688,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="383.6641" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="383.6641" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="383.6641" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="383.6641" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="391.9287" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="383.6641" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="391.9287" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="400.1934" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="400.1934" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="383.6641" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="400.1934" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="400.1934" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="408.458" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="408.458" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="400.1934" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="391.9287" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="383.6641" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="391.9287" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="400.1934" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="408.458" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="400.1934" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="400.1934" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="408.458" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="400.1934" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="391.9287" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="383.6641" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="383.6641" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="383.6641" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="383.6641" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="383.6641" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="392.4873" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="421.3882" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="383.6641" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="392.4873" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="422.6069" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="383.6641" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="392.4873" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="419.6616" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="383.6641" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="392.4873" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="416.2148" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="383.6641" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="392.4873" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="408.1152" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="383.6641" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="383.6641" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="383.6641" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="383.6641" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="383.6641" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="383.6641" y="879.4604">- Single responsibility per function</text><path d="M978.4497,272.2139 L978.4497,705.9326 L1319.8413,705.9326 L1319.8413,282.2139 L1309.8413,272.2139 L978.4497,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1309.8413,272.2139 L1309.8413,282.2139 L1319.8413,282.2139 L1309.8413,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="984.4497" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="984.4497" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="984.4497" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="984.4497" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="984.4497" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="992.7144" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="1000.979" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="1000.979" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="1000.979" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="992.7144" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="984.4497" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="992.7144" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="1000.979" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="1000.979" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="1000.979" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="992.7144" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="984.4497" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="992.7144" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="984.4497" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="984.4497" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="984.4497" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="984.4497" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="984.4497" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="984.4497" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="984.4497" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="984.4497" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="984.4497" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="984.4497" y="697.8667">- Improve naming</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="149.6152" x="555.7309" y="991.792"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="129.6152" x="565.7309" y="1012.9307">Click "Refund" button</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="200.6738" x="530.2016" y="1249.5732"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="180.6738" x="540.2016" y="1270.7119">Enter refund amount ($14.99)</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="206.1582" x="527.4594" y="1303.542"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="186.1582" x="537.4594" y="1324.6807">Enter reason ("Partial service")</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="167.7734" x="546.6518" y="1357.5107"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="147.7734" x="556.6518" y="1378.6494">Check "Notify customer"</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="156.0313" x="552.5229" y="1411.4795"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="136.0313" x="562.5229" y="1432.6182">Click "Process Refund"</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="208.1973" x="159.4668" y="3726.8306"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="188.1973" x="169.4668" y="3747.9692">See "Partially Refunded" status</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="190.8477" x="168.1416" y="3780.7993"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="170.8477" x="178.1416" y="3801.938">See refund amount ($14.99)</text><ellipse cx="263.5654" cy="3845.7681" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1;"/><ellipse cx="263.5654" cy="3845.7681" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1;"/><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="133.4668" x="16" y="4160.6431"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="113.4668" x="26" y="4181.7817">See error message</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="132.916" x="16.2754" y="4214.6118"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="112.916" x="26.2754" y="4235.7505">Decide next action</text><ellipse cx="82.7334" cy="4279.5806" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1;"/><ellipse cx="82.7334" cy="4279.5806" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1;"/><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="139.8242" x="464.2252" y="2327.4951"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="119.8242" x="474.2252" y="2348.6338">Fix validation errors</text><ellipse cx="534.1373" cy="2392.4639" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1;"/><ellipse cx="534.1373" cy="2392.4639" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1;"/><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="96.8926" x="695.6578" y="1677.9951"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="76.8926" x="705.6578" y="1699.1338">Enter reason</text><ellipse cx="744.1041" cy="1755.9639" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1;"/><ellipse cx="744.1041" cy="1755.9639" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1;"/><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="87.4531" x="925.397" y="1633.9951"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="67.4531" x="935.397" y="1655.1338">Fix amount</text><ellipse cx="969.1236" cy="1713.9639" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1;"/><ellipse cx="969.1236" cy="1713.9639" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1;"/><path d="M1262.7886,931.5264 L1262.7886,947.6592 L1242.7886,951.6592 L1262.7886,955.6592 L1262.7886,971.792 A0,0 0 0 0 1262.7886,971.792 L1431.3399,971.792 A0,0 0 0 0 1431.3399,971.792 L1431.3399,941.5264 L1421.3399,931.5264 L1262.7886,931.5264 A0,0 0 0 0 1262.7886,931.5264" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1421.3399,931.5264 L1421.3399,941.5264 L1431.3399,941.5264 L1421.3399,931.5264" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="147.5513" x="1268.7886" y="948.5933">Refunds only available</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="109.7446" x="1268.7886" y="963.7261">for PAID invoices</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="148.3789" x="1094.4097" y="934.6748"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="128.3789" x="1104.4097" y="955.8135">Hide "Refund" button</text><ellipse cx="1168.5992" cy="1009.0889" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1;"/><ellipse cx="1168.5992" cy="1009.0889" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10" x2="10" y1="54.3545" y2="4354.5806"/><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="110.7441" x="2121.691" y="174.2764"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="90.7441" x="2131.691" y="195.415">Display invoice</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="135.9688" x="2109.0787" y="228.2451"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="115.9688" x="2119.0787" y="249.3838">Show payment info</text><path d="M1655.1583,272.2139 L1655.1583,887.5264 L2098.1822,887.5264 L2098.1822,282.2139 L2088.1822,272.2139 L1655.1583,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M2088.1822,272.2139 L2088.1822,282.2139 L2098.1822,282.2139 L2088.1822,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="1661.1583" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1661.1583" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="1661.1583" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="1661.1583" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="1669.4229" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1661.1583" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="1669.4229" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="1677.6876" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="1677.6876" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1661.1583" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="1677.6876" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="1677.6876" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="1685.9522" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="1685.9522" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="1677.6876" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1669.4229" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1661.1583" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="1669.4229" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="1677.6876" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="1685.9522" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1677.6876" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="1677.6876" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="1685.9522" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1677.6876" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1669.4229" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1661.1583" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="1661.1583" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1661.1583" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="1661.1583" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="1661.1583" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="1669.9815" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="1698.8824" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="1661.1583" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="1669.9815" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="1700.1011" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="1661.1583" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="1669.9815" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="1697.1558" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="1661.1583" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="1669.9815" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="1693.7091" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="1661.1583" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="1669.9815" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="1685.6094" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1661.1583" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="1661.1583" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="1661.1583" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="1661.1583" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="1661.1583" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="1661.1583" y="879.4604">- Single responsibility per function</text><path d="M2255.9439,272.2139 L2255.9439,705.9326 L2597.3355,705.9326 L2597.3355,282.2139 L2587.3355,272.2139 L2255.9439,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M2587.3355,272.2139 L2587.3355,282.2139 L2597.3355,282.2139 L2587.3355,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="2261.9439" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="2261.9439" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="2261.9439" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="2261.9439" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="2261.9439" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="2270.2086" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="2278.4732" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="2278.4732" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="2278.4732" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="2270.2086" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="2261.9439" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="2270.2086" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="2278.4732" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="2278.4732" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="2278.4732" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="2270.2086" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="2261.9439" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="2270.2086" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="2261.9439" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="2261.9439" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="2261.9439" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="2261.9439" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="2261.9439" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="2261.9439" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="2261.9439" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="2261.9439" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="2261.9439" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="2261.9439" y="697.8667">- Improve naming</text><polygon fill="#FFFFFF" points="2110.1822,887.5264,2243.9439,887.5264,2255.9439,899.5264,2243.9439,911.5264,2110.1822,911.5264,2098.1822,899.5264,2110.1822,887.5264" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="133.7617" x="2110.1822" y="903.3345">Invoice status == PAID?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="2079.1739" y="896.9321">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="45.2729" x="2255.9439" y="896.9321">not paid</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="153.4004" x="1831.3325" y="931.5264"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="133.4004" x="1841.3325" y="952.665">Show "Refund" button</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="93.8398" x="1496.8292" y="3564.9243"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="73.8398" x="1506.8292" y="3586.063">Close modal</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="137.3047" x="1475.0968" y="3618.8931"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="117.3047" x="1485.0968" y="3640.0317">Show success toast</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="202.8184" x="1442.3399" y="3672.8618"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="182.8184" x="1452.3399" y="3694.0005">Update payment status badge</text><line style="stroke:#000000;stroke-width:1;" x1="1436.3399" x2="1436.3399" y1="54.3545" y2="4354.5806"/><path d="M2607.3355,272.2139 L2607.3355,887.5264 L3050.3594,887.5264 L3050.3594,282.2139 L3040.3594,272.2139 L2607.3355,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M3040.3594,272.2139 L3040.3594,282.2139 L3050.3594,282.2139 L3040.3594,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="2613.3355" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="2613.3355" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="2613.3355" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="2613.3355" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="2621.6002" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="2613.3355" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="2621.6002" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="2629.8648" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="2629.8648" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="2613.3355" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="2629.8648" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="2629.8648" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="2638.1295" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="2638.1295" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="2629.8648" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="2621.6002" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="2613.3355" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="2621.6002" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="2629.8648" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="2638.1295" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="2629.8648" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="2629.8648" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="2638.1295" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="2629.8648" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="2621.6002" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="2613.3355" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="2613.3355" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="2613.3355" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="2613.3355" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="2613.3355" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="2622.1588" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="2651.0596" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="2613.3355" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="2622.1588" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="2652.2784" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="2613.3355" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="2622.1588" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="2649.3331" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="2613.3355" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="2622.1588" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="2645.8863" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="2613.3355" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="2622.1588" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="2637.7867" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="2613.3355" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="2613.3355" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="2613.3355" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="2613.3355" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="2613.3355" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="2613.3355" y="879.4604">- Single responsibility per function</text><path d="M3060.3594,272.2139 L3060.3594,705.9326 L3401.751,705.9326 L3401.751,282.2139 L3391.751,272.2139 L3060.3594,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M3391.751,272.2139 L3391.751,282.2139 L3401.751,282.2139 L3391.751,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="3066.3594" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="3066.3594" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="3066.3594" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="3066.3594" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="3066.3594" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="3074.6241" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="3082.8887" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="3082.8887" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="3082.8887" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="3074.6241" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="3066.3594" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="3074.6241" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="3082.8887" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="3082.8887" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="3082.8887" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="3074.6241" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="3066.3594" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="3074.6241" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="3066.3594" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="3066.3594" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="3066.3594" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="3066.3594" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="3066.3594" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="3066.3594" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="3066.3594" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="3066.3594" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="3066.3594" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="3066.3594" y="697.8667">- Improve naming</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="139.4199" x="2790.5" y="1045.7607"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="119.4199" x="2800.5" y="1066.8994">Display refund form</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="151.1621" x="2784.6289" y="1099.7295"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="131.1621" x="2794.6289" y="1120.8682">Show original amount</text><rect fill="#FFFFFF" height="75.875" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="130.5195" x="2794.9502" y="1153.6982"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="71.0742" x="2804.9502" y="1174.8369">Input fields:</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="101.0332" x="2804.9502" y="1188.8057">- Refund amount</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="52.418" x="2804.9502" y="1202.7744">- Reason</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="110.5195" x="2804.9502" y="1216.7432">- Notify customer?</text><line style="stroke:#000000;stroke-width:1;" x1="2602.3355" x2="2602.3355" y1="54.3545" y2="4354.5806"/><path d="M3686.2684,272.2139 L3686.2684,887.5264 L4129.2923,887.5264 L4129.2923,282.2139 L4119.2923,272.2139 L3686.2684,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M4119.2923,272.2139 L4119.2923,282.2139 L4129.2923,282.2139 L4119.2923,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="3692.2684" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="3692.2684" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="3692.2684" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="3692.2684" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="3700.533" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="3692.2684" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="3700.533" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="3708.7977" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="3708.7977" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="3692.2684" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="3708.7977" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="3708.7977" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="3717.0623" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="3717.0623" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="3708.7977" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="3700.533" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="3692.2684" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="3700.533" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="3708.7977" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="3717.0623" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="3708.7977" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="3708.7977" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="3717.0623" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="3708.7977" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="3700.533" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="3692.2684" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="3692.2684" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="3692.2684" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="3692.2684" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="3692.2684" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="3701.0916" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="3729.9925" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="3692.2684" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="3701.0916" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="3731.2112" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="3692.2684" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="3701.0916" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="3728.2659" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="3692.2684" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="3701.0916" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="3724.8191" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="3692.2684" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="3701.0916" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="3716.7195" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="3692.2684" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="3692.2684" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="3692.2684" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="3692.2684" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="3692.2684" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="3692.2684" y="879.4604">- Single responsibility per function</text><path d="M4267.054,272.2139 L4267.054,705.9326 L4608.4456,705.9326 L4608.4456,282.2139 L4598.4456,272.2139 L4267.054,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M4598.4456,272.2139 L4598.4456,282.2139 L4608.4456,282.2139 L4598.4456,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="4273.054" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="4273.054" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="4273.054" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="4273.054" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="4273.054" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="4281.3186" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="4289.5833" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="4289.5833" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="4289.5833" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="4281.3186" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="4273.054" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="4281.3186" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="4289.5833" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="4289.5833" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="4289.5833" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="4281.3186" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="4273.054" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="4281.3186" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="4273.054" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="4273.054" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="4273.054" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="4273.054" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="4273.054" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="4273.054" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="4273.054" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="4273.054" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="4273.054" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="4273.054" y="697.8667">- Improve naming</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="101.293" x="3888.4963" y="1465.4482"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="81.293" x="3898.4963" y="1486.5869">Validate form</text><polygon fill="#FFFFFF" points="3881.3391,1519.417,3996.9465,1519.417,4008.9465,1532.2217,3996.9465,1545.0264,3881.3391,1545.0264,3869.3391,1532.2217,3881.3391,1519.417" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="94.1553" x="3881.3391" y="1529.6274">Amount &gt; 0 AND</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="115.6074" x="3881.3391" y="1542.4321">Amount &lt;= original?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="3850.3308" y="1529.6274">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="82.312" x="4008.9465" y="1529.6274">invalid amount</text><polygon fill="#FFFFFF" points="3551.3316,1565.0264,3649.7838,1565.0264,3661.7838,1577.0264,3649.7838,1589.0264,3551.3316,1589.0264,3539.3316,1577.0264,3551.3316,1565.0264" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="98.4521" x="3551.3316" y="1580.8345">Reason provided?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="3520.3233" y="1574.4321">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="54.6616" x="3661.7838" y="1574.4321">no reason</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="97.5723" x="3412.751" y="4106.6743"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="77.5723" x="3422.751" y="4127.813">Display error</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="160.4668" x="3762.5082" y="2273.5264"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="140.4668" x="3772.5082" y="2294.665">Display validation error</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="199.4668" x="3952.975" y="1609.0264"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="179.4668" x="3962.975" y="1630.165">Show "Reason required" error</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="190.5723" x="4162.4418" y="1565.0264"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="170.5723" x="4172.4418" y="1586.165">Show "Invalid amount" error</text><line style="stroke:#000000;stroke-width:1;" x1="3406.751" x2="3406.751" y1="54.3545" y2="4354.5806"/><path d="M4774.1741,272.2139 L4774.1741,887.5264 L5217.198,887.5264 L5217.198,282.2139 L5207.198,272.2139 L4774.1741,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M5207.198,272.2139 L5207.198,282.2139 L5217.198,282.2139 L5207.198,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="4780.1741" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="4780.1741" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="4780.1741" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="4780.1741" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="4788.4388" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="4780.1741" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="4788.4388" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="4796.7034" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="4796.7034" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="4780.1741" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="4796.7034" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="4796.7034" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="4804.9681" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="4804.9681" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="4796.7034" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="4788.4388" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="4780.1741" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="4788.4388" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="4796.7034" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="4804.9681" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="4796.7034" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="4796.7034" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="4804.9681" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="4796.7034" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="4788.4388" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="4780.1741" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="4780.1741" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="4780.1741" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="4780.1741" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="4780.1741" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="4788.9974" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="4817.8982" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="4780.1741" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="4788.9974" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="4819.117" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="4780.1741" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="4788.9974" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="4816.1717" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="4780.1741" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="4788.9974" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="4812.7249" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="4780.1741" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="4788.9974" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="4804.6253" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="4780.1741" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="4780.1741" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="4780.1741" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="4780.1741" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="4780.1741" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="4780.1741" y="879.4604">- Single responsibility per function</text><path d="M5227.198,272.2139 L5227.198,705.9326 L5568.5896,705.9326 L5568.5896,282.2139 L5558.5896,272.2139 L5227.198,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M5558.5896,272.2139 L5558.5896,282.2139 L5568.5896,282.2139 L5558.5896,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="5233.198" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="5233.198" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="5233.198" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="5233.198" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="5233.198" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="5241.4627" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="5249.7273" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="5249.7273" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="5249.7273" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="5241.4627" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="5233.198" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="5241.4627" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="5249.7273" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="5249.7273" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="5249.7273" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="5241.4627" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="5233.198" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="5241.4627" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="5233.198" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="5233.198" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="5233.198" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="5233.198" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="5233.198" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="5233.198" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="5233.198" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="5233.198" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="5233.198" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="5233.198" y="697.8667">- Improve naming</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="144.7285" x="4619.4456" y="1609.0264"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="124.7285" x="4629.4456" y="1630.165">Call processRefund()</text><line style="stroke:#000000;stroke-width:1;" x1="4613.4456" x2="4613.4456" y1="54.3545" y2="4354.5806"/><path d="M5731.6697,272.2139 L5731.6697,887.5264 L6174.6936,887.5264 L6174.6936,282.2139 L6164.6936,272.2139 L5731.6697,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M6164.6936,272.2139 L6164.6936,282.2139 L6174.6936,282.2139 L6164.6936,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="5737.6697" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="5737.6697" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="5737.6697" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="5737.6697" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="5745.9344" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="5737.6697" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="5745.9344" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="5754.199" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="5754.199" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="5737.6697" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="5754.199" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="5754.199" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="5762.4637" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="5762.4637" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="5754.199" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="5745.9344" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="5737.6697" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="5745.9344" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="5754.199" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="5762.4637" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="5754.199" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="5754.199" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="5762.4637" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="5754.199" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="5745.9344" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="5737.6697" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="5737.6697" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="5737.6697" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="5737.6697" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="5737.6697" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="5746.493" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="5775.3938" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="5737.6697" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="5746.493" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="5776.6126" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="5737.6697" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="5746.493" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="5773.6673" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="5737.6697" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="5746.493" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="5770.2205" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="5737.6697" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="5746.493" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="5762.1209" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="5737.6697" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="5737.6697" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="5737.6697" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="5737.6697" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="5737.6697" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="5737.6697" y="879.4604">- Single responsibility per function</text><path d="M6184.6936,272.2139 L6184.6936,705.9326 L6526.0853,705.9326 L6526.0853,282.2139 L6516.0853,272.2139 L6184.6936,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M6516.0853,272.2139 L6516.0853,282.2139 L6526.0853,282.2139 L6516.0853,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="6190.6936" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="6190.6936" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="6190.6936" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="6190.6936" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="6190.6936" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="6198.9583" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="6207.2229" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="6207.2229" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="6207.2229" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="6198.9583" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="6190.6936" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="6198.9583" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="6207.2229" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="6207.2229" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="6207.2229" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="6198.9583" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="6190.6936" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="6198.9583" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="6190.6936" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="6190.6936" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="6190.6936" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="6190.6936" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="6190.6936" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="6190.6936" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="6190.6936" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="6190.6936" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="6190.6936" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="6190.6936" y="697.8667">- Improve naming</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="142.0801" x="5579.5896" y="1677.9951"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="122.0801" x="5589.5896" y="1699.1338">Prepare RefundData</text><line style="stroke:#000000;stroke-width:1;" x1="5573.5896" x2="5573.5896" y1="54.3545" y2="4354.5806"/><path d="M6960.1521,272.2139 L6960.1521,887.5264 L7403.176,887.5264 L7403.176,282.2139 L7393.176,272.2139 L6960.1521,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M7393.176,272.2139 L7393.176,282.2139 L7403.176,282.2139 L7393.176,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="6966.1521" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="6966.1521" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="6966.1521" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="6966.1521" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="6974.4167" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="6966.1521" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="6974.4167" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="6982.6814" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="6982.6814" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="6966.1521" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="6982.6814" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="6982.6814" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="6990.946" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="6990.946" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="6982.6814" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="6974.4167" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="6966.1521" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="6974.4167" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="6982.6814" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="6990.946" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="6982.6814" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="6982.6814" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="6990.946" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="6982.6814" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="6974.4167" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="6966.1521" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="6966.1521" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="6966.1521" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="6966.1521" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="6966.1521" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="6974.9753" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="7003.8762" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="6966.1521" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="6974.9753" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="7005.0949" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="6966.1521" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="6974.9753" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="7002.1496" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="6966.1521" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="6974.9753" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="6998.7028" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="6966.1521" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="6974.9753" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="6990.6032" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="6966.1521" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="6966.1521" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="6966.1521" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="6966.1521" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="6966.1521" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="6966.1521" y="879.4604">- Single responsibility per function</text><path d="M7413.176,272.2139 L7413.176,705.9326 L7754.5676,705.9326 L7754.5676,282.2139 L7744.5676,272.2139 L7413.176,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M7744.5676,272.2139 L7744.5676,282.2139 L7754.5676,282.2139 L7744.5676,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="7419.176" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="7419.176" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="7419.176" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="7419.176" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="7419.176" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="7427.4406" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="7435.7053" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="7435.7053" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="7435.7053" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="7427.4406" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="7419.176" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="7427.4406" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="7435.7053" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="7435.7053" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="7435.7053" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="7427.4406" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="7419.176" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="7427.4406" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="7419.176" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="7419.176" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="7419.176" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="7419.176" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="7419.176" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="7419.176" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="7419.176" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="7419.176" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="7419.176" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="7419.176" y="697.8667">- Improve naming</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="217.7832" x="6732.3689" y="1744.9639"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="197.7832" x="6742.3689" y="1766.1025">processRefund(paymentId, data)</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="130.0332" x="6776.2439" y="1798.9326"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="110.0332" x="6786.2439" y="1820.0713">Set loading = true</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="129.4473" x="6683.2913" y="3456.9868"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="109.4473" x="6693.2913" y="3478.1255">Update local state</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="133.9531" x="6681.0384" y="3510.9556"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="113.9531" x="6691.0384" y="3532.0942">Set loading = false</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="130.7891" x="6538.6673" y="3998.7368"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="110.7891" x="6548.6673" y="4019.8755">Set error message</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="133.9531" x="6537.0853" y="4052.7056"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="113.9531" x="6547.0853" y="4073.8442">Set loading = false</text><line style="stroke:#000000;stroke-width:1;" x1="6531.0853" x2="6531.0853" y1="54.3545" y2="4354.5806"/><path d="M8622.2867,272.2139 L8622.2867,887.5264 L9065.3107,887.5264 L9065.3107,282.2139 L9055.3107,272.2139 L8622.2867,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M9055.3107,272.2139 L9055.3107,282.2139 L9065.3107,282.2139 L9055.3107,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="8628.2867" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="8628.2867" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="8628.2867" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="8628.2867" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="8636.5514" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="8628.2867" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="8636.5514" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="8644.816" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="8644.816" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="8628.2867" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="8644.816" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="8644.816" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="8653.0807" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="8653.0807" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="8644.816" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="8636.5514" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="8628.2867" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="8636.5514" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="8644.816" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="8653.0807" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="8644.816" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="8644.816" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="8653.0807" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="8644.816" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="8636.5514" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="8628.2867" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="8628.2867" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="8628.2867" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="8628.2867" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="8628.2867" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="8637.11" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="8666.0108" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="8628.2867" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="8637.11" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="8667.2296" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="8628.2867" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="8637.11" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="8664.2843" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="8628.2867" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="8637.11" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="8660.8375" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="8628.2867" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="8637.11" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="8652.7379" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="8628.2867" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="8628.2867" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="8628.2867" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="8628.2867" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="8628.2867" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="8628.2867" y="879.4604">- Single responsibility per function</text><path d="M9075.3107,272.2139 L9075.3107,705.9326 L9416.7023,705.9326 L9416.7023,282.2139 L9406.7023,272.2139 L9075.3107,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M9406.7023,272.2139 L9406.7023,282.2139 L9416.7023,282.2139 L9406.7023,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="9081.3107" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="9081.3107" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="9081.3107" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="9081.3107" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="9081.3107" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="9089.5753" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="9097.84" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="9097.84" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="9097.84" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="9089.5753" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="9081.3107" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="9089.5753" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="9097.84" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="9097.84" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="9097.84" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="9089.5753" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="9081.3107" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="9089.5753" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="9081.3107" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="9081.3107" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="9081.3107" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="9081.3107" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="9081.3107" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="9081.3107" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="9081.3107" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="9081.3107" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="9081.3107" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="9081.3107" y="697.8667">- Improve naming</text><path d="M8299.9547,1842.9014 L8299.9547,1995.2295 L8279.9547,1999.2295 L8299.9547,2003.2295 L8299.9547,2155.5576 A0,0 0 0 0 8299.9547,2155.5576 L8612.2867,2155.5576 A0,0 0 0 0 8612.2867,2155.5576 L8612.2867,1852.9014 L8602.2867,1842.9014 L8299.9547,1842.9014 A0,0 0 0 0 8299.9547,1842.9014" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M8602.2867,1842.9014 L8602.2867,1852.9014 L8612.2867,1852.9014 L8602.2867,1842.9014" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="158.7549" x="8305.9547" y="1859.9683">TDD Validation Tests:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="8305.9547" y="1875.1011">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="258.7749" x="8305.9547" y="1890.2339">it('should validate amount &gt; 0', () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.0674" x="8314.2193" y="1905.3667">expect(() =&gt; service.validateRefundData({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.0366" x="8322.484" y="1920.4995">amount: -10,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.8999" x="8322.484" y="1935.6323">reason: 'test'</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="227.8745" x="8314.2193" y="1950.7651">})).toThrow('amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="8305.9547" y="1965.8979">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="8305.9547" y="1981.0308">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="267.541" x="8305.9547" y="1996.1636">it('should validate reason exists', () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.0674" x="8314.2193" y="2011.2964">expect(() =&gt; service.validateRefundData({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="79.3457" x="8322.484" y="2026.4292">amount: 10,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9346" x="8322.484" y="2041.562">reason: ''</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="210.9644" x="8314.2193" y="2056.6948">})).toThrow('reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="8305.9547" y="2071.8276">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="8305.9547" y="2086.9604">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="8305.9547" y="2102.0933">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="187.8081" x="8305.9547" y="2117.2261">- Descriptive error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="109.7891" x="8305.9547" y="2132.3589">- Early validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="134.5132" x="8305.9547" y="2147.4917">- Clear requirements</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="176" x="8103.9547" y="1982.2451"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="156" x="8113.9547" y="2003.3838">validateRefundData(data)</text><polygon fill="#FFFFFF" points="8175.3553,2175.5576,8208.5541,2175.5576,8220.5541,2187.5576,8208.5541,2199.5576,8175.3553,2199.5576,8163.3553,2187.5576,8175.3553,2175.5576" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="33.1987" x="8175.3553" y="2191.3657">Valid?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="8144.347" y="2184.9634">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="64.6465" x="8220.5541" y="2184.9634">invalid data</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="264.4121" x="7765.5676" y="2219.5576"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="244.4121" x="7775.5676" y="2240.6963">POST /api/v1/admin/payments/:id/refund</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="125.4629" x="7835.0422" y="2273.5264"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="105.4629" x="7845.0422" y="2294.665">Send RefundData</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="117.459" x="8039.9797" y="3403.0181"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="97.459" x="8049.9797" y="3424.1567">Return Payment</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="90.3652" x="7852.591" y="3944.7681"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="70.3652" x="7862.591" y="3965.9067">Throw error</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="153.2598" x="8702.1301" y="2219.5576"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="133.2598" x="8712.1301" y="2240.6963">Throw validation error</text><line style="stroke:#000000;stroke-width:1;" x1="7759.5676" x2="7759.5676" y1="54.3545" y2="4354.5806"/><path d="M11088.6272,272.2139 L11088.6272,887.5264 L11531.6511,887.5264 L11531.6511,282.2139 L11521.6511,272.2139 L11088.6272,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M11521.6511,272.2139 L11521.6511,282.2139 L11531.6511,282.2139 L11521.6511,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="11094.6272" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="11094.6272" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="11094.6272" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="11094.6272" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="11102.8918" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="11094.6272" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="11102.8918" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="11111.1565" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="11111.1565" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="11094.6272" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="11111.1565" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="11111.1565" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="11119.4211" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="11119.4211" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="11111.1565" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="11102.8918" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="11094.6272" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="11102.8918" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="11111.1565" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="11119.4211" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="11111.1565" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="11111.1565" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="11119.4211" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="11111.1565" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="11102.8918" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="11094.6272" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="11094.6272" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="11094.6272" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="11094.6272" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="11094.6272" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="11103.4504" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="11132.3513" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="11094.6272" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="11103.4504" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="11133.57" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="11094.6272" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="11103.4504" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="11130.6247" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="11094.6272" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="11103.4504" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="11127.178" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="11094.6272" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="11103.4504" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="11119.0783" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="11094.6272" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="11094.6272" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="11094.6272" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="11094.6272" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="11094.6272" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="11094.6272" y="879.4604">- Single responsibility per function</text><path d="M11541.6511,272.2139 L11541.6511,705.9326 L11883.0427,705.9326 L11883.0427,282.2139 L11873.0427,272.2139 L11541.6511,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M11873.0427,272.2139 L11873.0427,282.2139 L11883.0427,282.2139 L11873.0427,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="11547.6511" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="11547.6511" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="11547.6511" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="11547.6511" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="11547.6511" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="11555.9157" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="11564.1804" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="11564.1804" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="11564.1804" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="11555.9157" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="11547.6511" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="11555.9157" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="11564.1804" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="11564.1804" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="11564.1804" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="11555.9157" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="11547.6511" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="11555.9157" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="11547.6511" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="11547.6511" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="11547.6511" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="11547.6511" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="11547.6511" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="11547.6511" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="11547.6511" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="11547.6511" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="11547.6511" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="11547.6511" y="697.8667">- Improve naming</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="148.8887" x="9791.9869" y="2327.4951"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="128.8887" x="9801.9869" y="2348.6338">Load payment record</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="158.3398" x="9787.2613" y="2381.4639"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="138.3398" x="9797.2613" y="2402.6025">Check refund eligibility</text><polygon fill="#FFFFFF" points="9815.7926,2435.4326,9917.0699,2435.4326,9929.0699,2447.4326,9917.0699,2459.4326,9815.7926,2459.4326,9803.7926,2447.4326,9815.7926,2435.4326" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="101.2773" x="9815.7926" y="2451.2407">Already refunded?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="9784.7843" y="2444.8384">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="13.7017" x="9929.0699" y="2444.8384">no</text><path d="M9568.3312,2483.8506 L9568.3312,2492.417 L9548.3312,2496.417 L9568.3312,2500.417 L9568.3312,2508.9834 A0,0 0 0 0 9568.3312,2508.9834 L9774.7843,2508.9834 A0,0 0 0 0 9774.7843,2508.9834 L9774.7843,2493.8506 L9764.7843,2483.8506 L9568.3312,2483.8506 A0,0 0 0 0 9568.3312,2483.8506" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M9764.7843,2483.8506 L9764.7843,2493.8506 L9774.7843,2493.8506 L9764.7843,2483.8506" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.4531" x="9574.3312" y="2500.9175">"Payment already refunded"</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="120.6289" x="9427.7023" y="2479.4326"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="100.6289" x="9437.7023" y="2500.5713">Return 400 error</text><polygon fill="#FFFFFF" points="10205.2546,2479.4326,10320.1799,2479.4326,10332.1799,2491.4326,10320.1799,2503.4326,10205.2546,2503.4326,10193.2546,2491.4326,10205.2546,2479.4326" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="114.9253" x="10205.2546" y="2495.2407">Amount &gt; available?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="10174.2463" y="2488.8384">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="13.7017" x="10332.1799" y="2488.8384">no</text><path d="M9927.5418,2527.8506 L9927.5418,2536.417 L9907.5418,2540.417 L9927.5418,2544.417 L9927.5418,2552.9834 A0,0 0 0 0 9927.5418,2552.9834 L10244.7107,2552.9834 A0,0 0 0 0 10244.7107,2552.9834 L10244.7107,2537.8506 L10234.7107,2527.8506 L9927.5418,2527.8506 A0,0 0 0 0 9927.5418,2527.8506" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M10234.7107,2527.8506 L10234.7107,2537.8506 L10244.7107,2537.8506 L10234.7107,2527.8506" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="296.1689" x="9933.5418" y="2544.9175">"Refund amount exceeds\navailable amount"</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="120.6289" x="9786.9129" y="2523.4326"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="100.6289" x="9796.9129" y="2544.5713">Return 400 error</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="153.7461" x="10601.334" y="2523.4326"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="133.7461" x="10611.334" y="2544.5713">Call payment provider</text><polygon fill="#FFFFFF" points="10626.3196,2577.4014,10730.0945,2577.4014,10742.0945,2589.4014,10730.0945,2601.4014,10626.3196,2601.4014,10614.3196,2589.4014,10626.3196,2577.4014" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="103.7749" x="10626.3196" y="2593.2095">Provider == Stripe</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="10595.3113" y="2586.8071">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="36.314" x="10742.0945" y="2586.8071">PayPal</text><polygon fill="#FFFFFF" points="10678.2071,2761.2451,10690.2071,2773.2451,10678.2071,2785.2451,10666.2071,2773.2451,10678.2071,2761.2451" style="stroke:#000000;stroke-width:1;"/><path d="M10569.1951,2839.2451 L10569.1951,2908.3428 L10549.1951,2912.3428 L10569.1951,2916.3428 L10569.1951,2985.4404 A0,0 0 0 0 10569.1951,2985.4404 L10794.9007,2985.4404 A0,0 0 0 0 10794.9007,2985.4404 L10794.9007,2849.2451 L10784.9007,2839.2451 L10569.1951,2839.2451 A0,0 0 0 0 10569.1951,2839.2451" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M10784.9007,2839.2451 L10784.9007,2849.2451 L10794.9007,2849.2451 L10784.9007,2839.2451" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139.6167" x="10575.1951" y="2856.312">Database Updates:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="149.7666" x="10575.1951" y="2871.4448">UPDATE payments SET</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="176.0649" x="10583.4598" y="2886.5776">refunded_amount = 14.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="184.8057" x="10583.4598" y="2901.7104">status = 'partially_refunded'</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="159.5166" x="10575.1951" y="2916.8433">WHERE id = payment_id</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="10575.1951" y="2931.9761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="162.7349" x="10575.1951" y="2947.1089">INSERT INTO refund_logs</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.4409" x="10583.4598" y="2962.2417">(payment_id, amount, reason,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="141.8003" x="10587.5921" y="2977.3745">admin_id, created_at)</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="163.3496" x="10385.8455" y="2895.3584"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="143.3496" x="10395.8455" y="2916.4971">Update payment record</text><polygon fill="#FFFFFF" points="10435.1031,3005.4404,10499.9375,3005.4404,10511.9375,3017.4404,10499.9375,3029.4404,10435.1031,3029.4404,10423.1031,3017.4404,10435.1031,3005.4404" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="64.8345" x="10435.1031" y="3021.2485">Full refund?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="10404.0948" y="3014.8462">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="35.4116" x="10511.9375" y="3014.8462">partial</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="159.043" x="10284.7107" y="3039.4404"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="139.043" x="10294.7107" y="3060.5791">Set status = 'refunded'</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="214.1094" x="10463.7537" y="3039.4404"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="194.1094" x="10473.7537" y="3060.5791">Set status = 'partially_refunded'</text><polygon fill="#FFFFFF" points="10467.5203,3079.4092,10479.5203,3091.4092,10467.5203,3103.4092,10455.5203,3091.4092,10467.5203,3079.4092" style="stroke:#000000;stroke-width:1;"/><polygon fill="#FFFFFF" points="10420.5984,3123.4092,10514.4422,3123.4092,10526.4422,3135.4092,10514.4422,3147.4092,10420.5984,3147.4092,10408.5984,3135.4092,10420.5984,3123.4092" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="10471.5203" y="3157.6196">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="93.8438" x="10420.5984" y="3139.2173">Notify customer?</text><polygon fill="#FFFFFF" points="10467.5203,3305.0493,10479.5203,3317.0493,10467.5203,3329.0493,10455.5203,3317.0493,10467.5203,3305.0493" style="stroke:#000000;stroke-width:1;"/><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="171.1719" x="10381.9344" y="3349.0493"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="151.1719" x="10391.9344" y="3370.188">Return updated Payment</text><path d="M10972.887,2839.2451 L10972.887,2870.5107 L10952.887,2874.5107 L10972.887,2878.5107 L10972.887,2909.7764 A0,0 0 0 0 10972.887,2909.7764 L11114.867,2909.7764 A0,0 0 0 0 11114.867,2909.7764 L11114.867,2849.2451 L11104.867,2839.2451 L10972.887,2839.2451 A0,0 0 0 0 10972.887,2839.2451" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M11104.867,2839.2451 L11104.867,2849.2451 L11114.867,2849.2451 L11104.867,2839.2451" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="101.3086" x="10978.887" y="2856.312">Provider errors:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="120.98" x="10978.887" y="2871.4448">- Insufficient funds</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="114.0737" x="10978.887" y="2886.5776">- Invalid payment</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="65.5078" x="10978.887" y="2901.7104">- API error</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="147.9863" x="10804.9007" y="2857.5264"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="127.9863" x="10814.9007" y="2878.665">Return provider error</text><polygon fill="#FFFFFF" points="10262.7172,3866.7681,10274.7172,3878.7681,10262.7172,3890.7681,10250.7172,3878.7681,10262.7172,3866.7681" style="stroke:#000000;stroke-width:1;"/><polygon fill="#FFFFFF" points="9866.4313,3900.7681,9878.4313,3912.7681,9866.4313,3924.7681,9854.4313,3912.7681,9866.4313,3900.7681" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="9421.7023" x2="9421.7023" y1="54.3545" y2="4354.5806"/><path d="M12076.3923,272.2139 L12076.3923,887.5264 L12519.4162,887.5264 L12519.4162,282.2139 L12509.4162,272.2139 L12076.3923,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M12509.4162,272.2139 L12509.4162,282.2139 L12519.4162,282.2139 L12509.4162,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="12082.3923" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="12082.3923" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="12082.3923" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="12082.3923" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="12090.657" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="12082.3923" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="12090.657" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="12098.9216" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="12098.9216" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="12082.3923" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="12098.9216" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="12098.9216" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="12107.1863" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="12107.1863" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="12098.9216" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="12090.657" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="12082.3923" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="12090.657" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="12098.9216" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="12107.1863" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="12098.9216" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="12098.9216" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="12107.1863" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="12098.9216" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="12090.657" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="12082.3923" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="12082.3923" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="12082.3923" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="12082.3923" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="12082.3923" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="12091.2155" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="12120.1164" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="12082.3923" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="12091.2155" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="12121.3352" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="12082.3923" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="12091.2155" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="12118.3899" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="12082.3923" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="12091.2155" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="12114.9431" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="12082.3923" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="12091.2155" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="12106.8435" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="12082.3923" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="12082.3923" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="12082.3923" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="12082.3923" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="12082.3923" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="12082.3923" y="879.4604">- Single responsibility per function</text><path d="M12529.4162,272.2139 L12529.4162,705.9326 L12870.8078,705.9326 L12870.8078,282.2139 L12860.8078,272.2139 L12529.4162,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M12860.8078,272.2139 L12860.8078,282.2139 L12870.8078,282.2139 L12860.8078,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="12535.4162" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="12535.4162" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="12535.4162" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="12535.4162" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="12535.4162" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="12543.6809" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="12551.9455" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="12551.9455" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="12551.9455" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="12543.6809" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="12535.4162" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="12543.6809" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="12551.9455" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="12551.9455" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="12551.9455" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="12543.6809" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="12535.4162" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="12543.6809" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="12535.4162" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="12535.4162" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="12535.4162" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="12535.4162" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="12535.4162" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="12535.4162" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="12535.4162" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="12535.4162" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="12535.4162" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="12535.4162" y="697.8667">- Improve naming</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="103.3203" x="11928.5573" y="2621.4014"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="83.3203" x="11938.5573" y="2642.54">Create refund</text><rect fill="#FFFFFF" height="75.875" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="172.3496" x="11894.0427" y="2675.3701"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="138.1465" x="11904.0427" y="2696.5088">stripe.refunds.create({</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="144.7207" x="11911.6716" y="2710.4775">payment_intent: pi_xxx,</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="84.6973" x="11911.6716" y="2724.4463">amount: 1499</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="12.3164" x="11904.0427" y="2738.415">})</text><line style="stroke:#000000;stroke-width:1;" x1="11888.0427" x2="11888.0427" y1="54.3545" y2="4354.5806"/><path d="M13158.4958,272.2139 L13158.4958,887.5264 L13601.5197,887.5264 L13601.5197,282.2139 L13591.5197,272.2139 L13158.4958,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M13591.5197,272.2139 L13591.5197,282.2139 L13601.5197,282.2139 L13591.5197,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="13164.4958" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="13164.4958" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="13164.4958" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="13164.4958" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="13172.7605" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="13164.4958" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="13172.7605" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="13181.0251" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="13181.0251" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="13164.4958" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="13181.0251" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="13181.0251" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="13189.2898" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="13189.2898" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="13181.0251" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="13172.7605" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="13164.4958" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="13172.7605" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="13181.0251" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="13189.2898" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="13181.0251" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="13181.0251" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="13189.2898" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="13181.0251" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="13172.7605" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="13164.4958" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="13164.4958" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="13164.4958" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="13164.4958" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="13164.4958" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="13173.3191" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="13202.2199" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="13164.4958" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="13173.3191" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="13203.4387" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="13164.4958" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="13173.3191" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="13200.4934" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="13164.4958" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="13173.3191" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="13197.0466" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="13164.4958" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="13173.3191" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="13188.947" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="13164.4958" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="13164.4958" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="13164.4958" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="13164.4958" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="13164.4958" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="13164.4958" y="879.4604">- Single responsibility per function</text><path d="M13611.5197,272.2139 L13611.5197,705.9326 L13952.9114,705.9326 L13952.9114,282.2139 L13942.9114,272.2139 L13611.5197,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M13942.9114,272.2139 L13942.9114,282.2139 L13952.9114,282.2139 L13942.9114,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="13617.5197" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="13617.5197" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="13617.5197" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="13617.5197" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="13617.5197" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="13625.7844" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="13634.049" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="13634.049" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="13634.049" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="13625.7844" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="13617.5197" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="13625.7844" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="13634.049" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="13634.049" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="13634.049" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="13625.7844" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="13617.5197" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="13625.7844" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="13617.5197" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="13617.5197" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="13617.5197" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="13617.5197" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="13617.5197" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="13617.5197" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="13617.5197" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="13617.5197" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="13617.5197" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="13617.5197" y="697.8667">- Improve naming</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="111.1602" x="13003.2165" y="2621.4014"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="91.1602" x="13013.2165" y="2642.54">Capture refund</text><rect fill="#FFFFFF" height="75.875" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="179.3984" x="12969.0974" y="2675.3701"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="159.3984" x="12979.0974" y="2696.5088">paypal.payments.refund({</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="96.123" x="12986.7263" y="2710.4775">capture_id: xxx,</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="88.5117" x="12986.7263" y="2724.4463">amount: 14.99</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="12.3164" x="12979.0974" y="2738.415">})</text><polygon fill="#FFFFFF" points="12911.8161,2805.2451,13009.903,2805.2451,13021.903,2817.2451,13009.903,2829.2451,12911.8161,2829.2451,12899.8161,2817.2451,12911.8161,2805.2451" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="98.0869" x="12911.8161" y="2821.0532">Provider success?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="12880.8078" y="2814.6509">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="80.0454" x="13021.903" y="2814.6509">provider failed</text><line style="stroke:#000000;stroke-width:1;" x1="12875.8078" x2="12875.8078" y1="54.3545" y2="4354.5806"/><path d="M14353.2737,272.2139 L14353.2737,887.5264 L14796.2976,887.5264 L14796.2976,282.2139 L14786.2976,272.2139 L14353.2737,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M14786.2976,272.2139 L14786.2976,282.2139 L14796.2976,282.2139 L14786.2976,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.1289" x="14359.2737" y="289.2808">Service Architecture (DI):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="14359.2737" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="14359.2737" y="319.5464">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="326.8599" x="14359.2737" y="334.6792">class InvoiceService implements IInvoiceService {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="283.4546" x="14367.5383" y="349.812">constructor(private apiClient: IApiClient) {}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="14359.2737" y="364.9448">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="413.7593" x="14367.5383" y="380.0776">async processRefund(paymentId: number, data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.4951" x="14375.803" y="395.2104">// Validation (SRP)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.8535" x="14375.803" y="410.3433">this.validateRefundData(data)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="14359.2737" y="425.4761">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59.9282" x="14375.803" y="440.6089">// API call</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.4004" x="14375.803" y="455.7417">return await this.apiClient.post(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322.0801" x="14384.0676" y="470.8745">`/api/v1/admin/payments/${paymentId}/refund`,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="14384.0676" y="486.0073">data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="14375.803" y="501.1401">)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="14367.5383" y="516.2729">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="14359.2737" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="317.3892" x="14367.5383" y="546.5386">private validateRefundData(data: RefundData) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262.5708" x="14375.803" y="561.6714">if (!data.amount || data.amount &lt;= 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="307.2393" x="14384.0676" y="576.8042">throw new Error('Refund amount must be &gt; 0')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="14375.803" y="591.937">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="348.2578" x="14375.803" y="607.0698">if (!data.reason || data.reason.trim().length === 0) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="290.3291" x="14384.0676" y="622.2026">throw new Error('Refund reason is required')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="14375.803" y="637.3354">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="14367.5383" y="652.4683">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="14359.2737" y="667.6011">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="14359.2737" y="682.7339">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="14359.2737" y="697.8667">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.8359" x="14359.2737" y="712.9995">SOLID Compliance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="14359.2737" y="728.1323">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.9009" x="14368.0969" y="728.1323">SRP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="14396.9978" y="728.1323">: Service only handles API calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="14359.2737" y="743.2651">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.1196" x="14368.0969" y="743.2651">OCP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.6479" x="14398.2165" y="743.2651">: Can extend with new refund types</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="14359.2737" y="758.3979">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.1743" x="14368.0969" y="758.3979">LSP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.981" x="14395.2712" y="758.3979">: IInvoiceService interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="14359.2737" y="773.5308">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.7275" x="14368.0969" y="773.5308">ISP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="14391.8244" y="773.5308">: Specific refund interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.6909" x="14359.2737" y="788.6636">-</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.6279" x="14368.0969" y="788.6636">DI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.9922" x="14383.7248" y="788.6636">: ApiClient injected</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="14359.2737" y="803.7964">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87.1597" x="14359.2737" y="818.9292">Clean Code:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="14359.2737" y="834.062">- Small functions (&lt;20 lines)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.1333" x="14359.2737" y="849.1948">- Descriptive names</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="14359.2737" y="864.3276">- Clear error messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.7075" x="14359.2737" y="879.4604">- Single responsibility per function</text><path d="M14806.2976,272.2139 L14806.2976,705.9326 L15147.6892,705.9326 L15147.6892,282.2139 L15137.6892,272.2139 L14806.2976,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M15137.6892,272.2139 L15137.6892,282.2139 L15147.6892,282.2139 L15137.6892,272.2139" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.043" x="14812.2976" y="289.2808">TDD Process:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="14812.2976" y="304.4136">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192.4673" x="14812.2976" y="319.5464">1. RED - Write failing test:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84.7666" x="14812.2976" y="334.6792">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.0059" x="14812.2976" y="349.812">it('should process full refund', async () =&gt; {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.6821" x="14820.5622" y="364.9448">mockApiClient.post.mockResolvedValue({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32.7793" x="14828.8269" y="380.0776">id: 1,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.6377" x="14828.8269" y="395.2104">status: 'refunded',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.7144" x="14828.8269" y="410.3433">refundedAmount: 29.99</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="14820.5622" y="425.4761">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="14812.2976" y="440.6089">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312.127" x="14820.5622" y="455.7417">const result = await service.processRefund(1, {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.02" x="14828.8269" y="470.8745">amount: 29.99,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.4858" x="14828.8269" y="486.0073">reason: 'customer_request',</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.5098" x="14828.8269" y="501.1401">notifyCustomer: true</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="14820.5622" y="516.2729">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="14812.2976" y="531.4058">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.7622" x="14820.5622" y="546.5386">expect(result.status).toBe('refunded')</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="14812.2976" y="561.6714">})</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="19.5" x="14812.2976" y="576.8042">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="14812.2976" y="591.937">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.2705" x="14812.2976" y="607.0698">2. GREEN - Implement:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.3228" x="14812.2976" y="622.2026">(Implementation shown in note below)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="14812.2976" y="637.3354">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.0103" x="14812.2976" y="652.4683">3. REFACTOR:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.519" x="14812.2976" y="667.6011">- Extract validation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="14812.2976" y="682.7339">- Add error handling</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="115.667" x="14812.2976" y="697.8667">- Improve naming</text><path d="M14148.6145,3169.1196 L14148.6145,3223.0845 L14128.6145,3227.0845 L14148.6145,3231.0845 L14148.6145,3285.0493 A0,0 0 0 0 14148.6145,3285.0493 L14343.2737,3285.0493 A0,0 0 0 0 14343.2737,3285.0493 L14343.2737,3179.1196 L14333.2737,3169.1196 L14148.6145,3169.1196 A0,0 0 0 0 14148.6145,3169.1196" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M14333.2737,3169.1196 L14333.2737,3179.1196 L14343.2737,3179.1196 L14333.2737,3169.1196" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118.6313" x="14154.6145" y="3186.1865">Email Template:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="173.6592" x="14154.6145" y="3201.3193">Subject: Refund Processed</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="37.1973" x="14154.6145" y="3216.4521">Body:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="113.9849" x="14154.6145" y="3231.585">- Original amount</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="109.4526" x="14154.6145" y="3246.7178">- Refund amount</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="56.7861" x="14154.6145" y="3261.8506">- Reason</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="133.7515" x="14154.6145" y="3276.9834">- Remaining balance</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="164.7031" x="13963.9114" y="3210.1001"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="144.7031" x="13973.9114" y="3231.2388">Send refund notification</text><line style="stroke:#000000;stroke-width:1;" x1="13957.9114" x2="13957.9114" y1="54.3545" y2="4354.5806"/><line style="stroke:#000000;stroke-width:1;" x1="15152.6892" x2="15152.6892" y1="54.3545" y2="4354.5806"/><line style="stroke:#000000;stroke-width:1;" x1="899.5688" x2="899.5688" y1="100.3076" y2="120.3076"/><polygon fill="#000000" points="895.5688,110.3076,899.5688,120.3076,903.5688,110.3076,899.5688,114.3076" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="630.5385" x2="630.5385" y1="1283.542" y2="1303.542"/><polygon fill="#000000" points="626.5385,1293.542,630.5385,1303.542,634.5385,1293.542,630.5385,1297.542" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="630.5385" x2="630.5385" y1="1337.5107" y2="1357.5107"/><polygon fill="#000000" points="626.5385,1347.5107,630.5385,1357.5107,634.5385,1347.5107,630.5385,1351.5107" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="630.5385" x2="630.5385" y1="1391.4795" y2="1411.4795"/><polygon fill="#000000" points="626.5385,1401.4795,630.5385,1411.4795,634.5385,1401.4795,630.5385,1405.4795" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="263.5654" x2="263.5654" y1="3760.7993" y2="3780.7993"/><polygon fill="#000000" points="259.5654,3770.7993,263.5654,3780.7993,267.5654,3770.7993,263.5654,3774.7993" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="263.5654" x2="263.5654" y1="3814.7681" y2="3834.7681"/><polygon fill="#000000" points="259.5654,3824.7681,263.5654,3834.7681,267.5654,3824.7681,263.5654,3828.7681" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="82.7334" x2="82.7334" y1="4194.6118" y2="4214.6118"/><polygon fill="#000000" points="78.7334,4204.6118,82.7334,4214.6118,86.7334,4204.6118,82.7334,4208.6118" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="82.7334" x2="82.7334" y1="4248.5806" y2="4268.5806"/><polygon fill="#000000" points="78.7334,4258.5806,82.7334,4268.5806,86.7334,4258.5806,82.7334,4262.5806" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="534.1373" x2="534.1373" y1="2361.4639" y2="2381.4639"/><polygon fill="#000000" points="530.1373,2371.4639,534.1373,2381.4639,538.1373,2371.4639,534.1373,2375.4639" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="744.1041" x2="744.1041" y1="1711.9639" y2="1744.9639"/><polygon fill="#000000" points="740.1041,1734.9639,744.1041,1744.9639,748.1041,1734.9639,744.1041,1738.9639" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="969.1236" x2="969.1236" y1="1667.9639" y2="1702.9639"/><polygon fill="#000000" points="965.1236,1692.9639,969.1236,1702.9639,973.1236,1692.9639,969.1236,1696.9639" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="1168.5992" x2="1168.5992" y1="968.6436" y2="998.0889"/><polygon fill="#000000" points="1164.5992,988.0889,1168.5992,998.0889,1172.5992,988.0889,1168.5992,992.0889" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="2177.0631" x2="2177.0631" y1="208.2451" y2="228.2451"/><polygon fill="#000000" points="2173.0631,218.2451,2177.0631,228.2451,2181.0631,218.2451,2177.0631,222.2451" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="1543.7491" x2="1543.7491" y1="3598.8931" y2="3618.8931"/><polygon fill="#000000" points="1539.7491,3608.8931,1543.7491,3618.8931,1547.7491,3608.8931,1543.7491,3612.8931" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="1543.7491" x2="1543.7491" y1="3652.8618" y2="3672.8618"/><polygon fill="#000000" points="1539.7491,3662.8618,1543.7491,3672.8618,1547.7491,3662.8618,1543.7491,3666.8618" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="2098.1822" x2="1908.0327" y1="899.5264" y2="899.5264"/><line style="stroke:#000000;stroke-width:1;" x1="1908.0327" x2="1908.0327" y1="899.5264" y2="931.5264"/><polygon fill="#000000" points="1904.0327,921.5264,1908.0327,931.5264,1912.0327,921.5264,1908.0327,925.5264" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="2177.0631" x2="2177.0631" y1="262.2139" y2="887.5264"/><polygon fill="#000000" points="2173.0631,877.5264,2177.0631,887.5264,2181.0631,877.5264,2177.0631,881.5264" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="2860.21" x2="2860.21" y1="1079.7295" y2="1099.7295"/><polygon fill="#000000" points="2856.21,1089.7295,2860.21,1099.7295,2864.21,1089.7295,2860.21,1093.7295" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="2860.21" x2="2860.21" y1="1133.6982" y2="1153.6982"/><polygon fill="#000000" points="2856.21,1143.6982,2860.21,1153.6982,2864.21,1143.6982,2860.21,1147.6982" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="3661.7838" x2="4052.7084" y1="1577.0264" y2="1577.0264"/><line style="stroke:#000000;stroke-width:1;" x1="4052.7084" x2="4052.7084" y1="1577.0264" y2="1609.0264"/><polygon fill="#000000" points="4048.7084,1599.0264,4052.7084,1609.0264,4056.7084,1599.0264,4052.7084,1603.0264" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="3869.3391" x2="3600.5577" y1="1532.2217" y2="1532.2217"/><line style="stroke:#000000;stroke-width:1;" x1="3600.5577" x2="3600.5577" y1="1532.2217" y2="1565.0264"/><polygon fill="#000000" points="3596.5577,1555.0264,3600.5577,1565.0264,3604.5577,1555.0264,3600.5577,1559.0264" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="4008.9465" x2="4257.7279" y1="1532.2217" y2="1532.2217"/><line style="stroke:#000000;stroke-width:1;" x1="4257.7279" x2="4257.7279" y1="1532.2217" y2="1565.0264"/><polygon fill="#000000" points="4253.7279,1555.0264,4257.7279,1565.0264,4261.7279,1555.0264,4257.7279,1559.0264" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="3939.1428" x2="3939.1428" y1="1499.417" y2="1519.417"/><polygon fill="#000000" points="3935.1428,1509.417,3939.1428,1519.417,3943.1428,1509.417,3939.1428,1513.417" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="6841.2605" x2="6841.2605" y1="1778.9326" y2="1798.9326"/><polygon fill="#000000" points="6837.2605,1788.9326,6841.2605,1798.9326,6845.2605,1788.9326,6841.2605,1792.9326" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="6748.0149" x2="6748.0149" y1="3490.9556" y2="3510.9556"/><polygon fill="#000000" points="6744.0149,3500.9556,6748.0149,3510.9556,6752.0149,3500.9556,6748.0149,3504.9556" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="6604.0618" x2="6604.0618" y1="4032.7056" y2="4052.7056"/><polygon fill="#000000" points="6600.0618,4042.7056,6604.0618,4052.7056,6608.0618,4042.7056,6604.0618,4046.7056" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="7897.7736" x2="7897.7736" y1="2253.5264" y2="2273.5264"/><polygon fill="#000000" points="7893.7736,2263.5264,7897.7736,2273.5264,7901.7736,2263.5264,7897.7736,2267.5264" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="8163.3553" x2="7897.7736" y1="2187.5576" y2="2187.5576"/><line style="stroke:#000000;stroke-width:1;" x1="7897.7736" x2="7897.7736" y1="2187.5576" y2="2219.5576"/><polygon fill="#000000" points="7893.7736,2209.5576,7897.7736,2219.5576,7901.7736,2209.5576,7897.7736,2213.5576" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="8220.5541" x2="8778.7599" y1="2187.5576" y2="2187.5576"/><line style="stroke:#000000;stroke-width:1;" x1="8778.7599" x2="8778.7599" y1="2187.5576" y2="2219.5576"/><polygon fill="#000000" points="8774.7599,2209.5576,8778.7599,2219.5576,8782.7599,2209.5576,8778.7599,2213.5576" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="8191.9547" x2="8191.9547" y1="2016.2139" y2="2175.5576"/><polygon fill="#000000" points="8187.9547,2165.5576,8191.9547,2175.5576,8195.9547,2165.5576,8191.9547,2169.5576" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="9866.4313" x2="9866.4313" y1="2361.4639" y2="2381.4639"/><polygon fill="#000000" points="9862.4313,2371.4639,9866.4313,2381.4639,9870.4313,2371.4639,9866.4313,2375.4639" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10678.2071" x2="10678.2071" y1="2557.4014" y2="2577.4014"/><polygon fill="#000000" points="10674.2071,2567.4014,10678.2071,2577.4014,10682.2071,2567.4014,10678.2071,2571.4014" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10423.1031" x2="10364.2322" y1="3017.4404" y2="3017.4404"/><line style="stroke:#000000;stroke-width:1;" x1="10364.2322" x2="10364.2322" y1="3017.4404" y2="3039.4404"/><polygon fill="#000000" points="10360.2322,3029.4404,10364.2322,3039.4404,10368.2322,3029.4404,10364.2322,3033.4404" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10511.9375" x2="10570.8084" y1="3017.4404" y2="3017.4404"/><line style="stroke:#000000;stroke-width:1;" x1="10570.8084" x2="10570.8084" y1="3017.4404" y2="3039.4404"/><polygon fill="#000000" points="10566.8084,3029.4404,10570.8084,3039.4404,10574.8084,3029.4404,10570.8084,3033.4404" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10364.2322" x2="10364.2322" y1="3073.4092" y2="3091.4092"/><line style="stroke:#000000;stroke-width:1;" x1="10364.2322" x2="10455.5203" y1="3091.4092" y2="3091.4092"/><polygon fill="#000000" points="10445.5203,3087.4092,10455.5203,3091.4092,10445.5203,3095.4092,10449.5203,3091.4092" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10570.8084" x2="10570.8084" y1="3073.4092" y2="3091.4092"/><line style="stroke:#000000;stroke-width:1;" x1="10570.8084" x2="10479.5203" y1="3091.4092" y2="3091.4092"/><polygon fill="#000000" points="10489.5203,3087.4092,10479.5203,3091.4092,10489.5203,3095.4092,10485.5203,3091.4092" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10467.5203" x2="10467.5203" y1="2929.3271" y2="3005.4404"/><polygon fill="#000000" points="10463.5203,2995.4404,10467.5203,3005.4404,10471.5203,2995.4404,10467.5203,2999.4404" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10408.5984" x2="10375.1687" y1="3135.4092" y2="3135.4092"/><polygon fill="#000000" points="10371.1687,3217.0845,10375.1687,3227.0845,10379.1687,3217.0845,10375.1687,3221.0845" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10375.1687" x2="10375.1687" y1="3135.4092" y2="3317.0493"/><line style="stroke:#000000;stroke-width:1;" x1="10375.1687" x2="10455.5203" y1="3317.0493" y2="3317.0493"/><polygon fill="#000000" points="10445.5203,3313.0493,10455.5203,3317.0493,10445.5203,3321.0493,10449.5203,3317.0493" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10467.5203" x2="10467.5203" y1="3103.4092" y2="3123.4092"/><polygon fill="#000000" points="10463.5203,3113.4092,10467.5203,3123.4092,10471.5203,3113.4092,10467.5203,3117.4092" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10467.5203" x2="10467.5203" y1="3329.0493" y2="3349.0493"/><polygon fill="#000000" points="10463.5203,3339.0493,10467.5203,3349.0493,10471.5203,3339.0493,10467.5203,3343.0493" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10193.2546" x2="9847.2273" y1="2491.4326" y2="2491.4326"/><line style="stroke:#000000;stroke-width:1;" x1="9847.2273" x2="9847.2273" y1="2491.4326" y2="2523.4326"/><polygon fill="#000000" points="9843.2273,2513.4326,9847.2273,2523.4326,9851.2273,2513.4326,9847.2273,2517.4326" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10332.1799" x2="10678.2071" y1="2491.4326" y2="2491.4326"/><line style="stroke:#000000;stroke-width:1;" x1="10678.2071" x2="10678.2071" y1="2491.4326" y2="2523.4326"/><polygon fill="#000000" points="10674.2071,2513.4326,10678.2071,2523.4326,10682.2071,2513.4326,10678.2071,2517.4326" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="9847.2273" x2="9847.2273" y1="2557.4014" y2="3878.7681"/><line style="stroke:#000000;stroke-width:1;" x1="9847.2273" x2="10250.7172" y1="3878.7681" y2="3878.7681"/><polygon fill="#000000" points="10240.7172,3874.7681,10250.7172,3878.7681,10240.7172,3882.7681,10244.7172,3878.7681" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="9803.7926" x2="9488.0167" y1="2447.4326" y2="2447.4326"/><line style="stroke:#000000;stroke-width:1;" x1="9488.0167" x2="9488.0167" y1="2447.4326" y2="2479.4326"/><polygon fill="#000000" points="9484.0167,2469.4326,9488.0167,2479.4326,9492.0167,2469.4326,9488.0167,2473.4326" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="9929.0699" x2="10262.7172" y1="2447.4326" y2="2447.4326"/><line style="stroke:#000000;stroke-width:1;" x1="10262.7172" x2="10262.7172" y1="2447.4326" y2="2479.4326"/><polygon fill="#000000" points="10258.7172,2469.4326,10262.7172,2479.4326,10266.7172,2469.4326,10262.7172,2473.4326" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="9488.0167" x2="9488.0167" y1="2513.4014" y2="3912.7681"/><line style="stroke:#000000;stroke-width:1;" x1="9488.0167" x2="9854.4313" y1="3912.7681" y2="3912.7681"/><polygon fill="#000000" points="9844.4313,3908.7681,9854.4313,3912.7681,9844.4313,3916.7681,9848.4313,3912.7681" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10262.7172" x2="10262.7172" y1="3890.7681" y2="3912.7681"/><line style="stroke:#000000;stroke-width:1;" x1="10262.7172" x2="9878.4313" y1="3912.7681" y2="3912.7681"/><polygon fill="#000000" points="9888.4313,3908.7681,9878.4313,3912.7681,9888.4313,3916.7681,9884.4313,3912.7681" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="9866.4313" x2="9866.4313" y1="2415.4326" y2="2435.4326"/><polygon fill="#000000" points="9862.4313,2425.4326,9866.4313,2435.4326,9870.4313,2425.4326,9866.4313,2429.4326" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="11980.2175" x2="11980.2175" y1="2655.3701" y2="2675.3701"/><polygon fill="#000000" points="11976.2175,2665.3701,11980.2175,2675.3701,11984.2175,2665.3701,11980.2175,2669.3701" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="13058.7966" x2="13058.7966" y1="2655.3701" y2="2675.3701"/><polygon fill="#000000" points="13054.7966,2665.3701,13058.7966,2675.3701,13062.7966,2665.3701,13058.7966,2669.3701" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="899.5688" x2="899.5688" y1="154.2764" y2="159.2764"/><line style="stroke:#000000;stroke-width:1;" x1="899.5688" x2="2177.0631" y1="159.2764" y2="159.2764"/><line style="stroke:#000000;stroke-width:1;" x1="2177.0631" x2="2177.0631" y1="159.2764" y2="174.2764"/><polygon fill="#000000" points="2173.0631,164.2764,2177.0631,174.2764,2181.0631,164.2764,2177.0631,168.2764" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="1908.0327" x2="1908.0327" y1="965.4951" y2="976.792"/><line style="stroke:#000000;stroke-width:1;" x1="1908.0327" x2="630.5385" y1="976.792" y2="976.792"/><line style="stroke:#000000;stroke-width:1;" x1="630.5385" x2="630.5385" y1="976.792" y2="991.792"/><polygon fill="#000000" points="626.5385,981.792,630.5385,991.792,634.5385,981.792,630.5385,985.792" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="630.5385" x2="630.5385" y1="1025.7607" y2="1030.7607"/><line style="stroke:#000000;stroke-width:1;" x1="630.5385" x2="2860.21" y1="1030.7607" y2="1030.7607"/><line style="stroke:#000000;stroke-width:1;" x1="2860.21" x2="2860.21" y1="1030.7607" y2="1045.7607"/><polygon fill="#000000" points="2856.21,1035.7607,2860.21,1045.7607,2864.21,1035.7607,2860.21,1039.7607" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="2860.21" x2="2860.21" y1="1229.5732" y2="1234.5732"/><line style="stroke:#000000;stroke-width:1;" x1="2860.21" x2="630.5385" y1="1234.5732" y2="1234.5732"/><line style="stroke:#000000;stroke-width:1;" x1="630.5385" x2="630.5385" y1="1234.5732" y2="1249.5732"/><polygon fill="#000000" points="626.5385,1239.5732,630.5385,1249.5732,634.5385,1239.5732,630.5385,1243.5732" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="630.5385" x2="630.5385" y1="1445.4482" y2="1450.4482"/><line style="stroke:#000000;stroke-width:1;" x1="630.5385" x2="3939.1428" y1="1450.4482" y2="1450.4482"/><line style="stroke:#000000;stroke-width:1;" x1="3939.1428" x2="3939.1428" y1="1450.4482" y2="1465.4482"/><polygon fill="#000000" points="3935.1428,1455.4482,3939.1428,1465.4482,3943.1428,1455.4482,3939.1428,1459.4482" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="4691.8099" x2="4691.8099" y1="1642.9951" y2="1660.4951"/><line style="stroke:#000000;stroke-width:1;" x1="4691.8099" x2="5650.6297" y1="1660.4951" y2="1660.4951"/><line style="stroke:#000000;stroke-width:1;" x1="5650.6297" x2="5650.6297" y1="1660.4951" y2="1677.9951"/><polygon fill="#000000" points="5646.6297,1667.9951,5650.6297,1677.9951,5654.6297,1667.9951,5650.6297,1671.9951" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="5650.6297" x2="5650.6297" y1="1711.9639" y2="1729.4639"/><line style="stroke:#000000;stroke-width:1;" x1="5650.6297" x2="6841.2605" y1="1729.4639" y2="1729.4639"/><line style="stroke:#000000;stroke-width:1;" x1="6841.2605" x2="6841.2605" y1="1729.4639" y2="1744.9639"/><polygon fill="#000000" points="6837.2605,1734.9639,6841.2605,1744.9639,6845.2605,1734.9639,6841.2605,1738.9639" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="6841.2605" x2="6841.2605" y1="1832.9014" y2="1895.0732"/><line style="stroke:#000000;stroke-width:1;" x1="6841.2605" x2="8191.9547" y1="1895.0732" y2="1895.0732"/><line style="stroke:#000000;stroke-width:1;" x1="8191.9547" x2="8191.9547" y1="1895.0732" y2="1982.2451"/><polygon fill="#000000" points="8187.9547,1972.2451,8191.9547,1982.2451,8195.9547,1972.2451,8191.9547,1976.2451" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="7897.7736" x2="7897.7736" y1="2307.4951" y2="2312.4951"/><line style="stroke:#000000;stroke-width:1;" x1="7897.7736" x2="9866.4313" y1="2312.4951" y2="2312.4951"/><line style="stroke:#000000;stroke-width:1;" x1="9866.4313" x2="9866.4313" y1="2312.4951" y2="2327.4951"/><polygon fill="#000000" points="9862.4313,2317.4951,9866.4313,2327.4951,9870.4313,2317.4951,9866.4313,2321.4951" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10614.3196" x2="10602.3196" y1="2589.4014" y2="2589.4014"/><line style="stroke:#000000;stroke-width:1;" x1="10602.3196" x2="10602.3196" y1="2589.4014" y2="2607.4014"/><line style="stroke:#000000;stroke-width:1;" x1="10602.3196" x2="11980.2175" y1="2607.4014" y2="2607.4014"/><line style="stroke:#000000;stroke-width:1;" x1="11980.2175" x2="11980.2175" y1="2607.4014" y2="2621.4014"/><polygon fill="#000000" points="11976.2175,2611.4014,11980.2175,2621.4014,11984.2175,2611.4014,11980.2175,2615.4014" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10742.0945" x2="13058.7966" y1="2589.4014" y2="2589.4014"/><line style="stroke:#000000;stroke-width:1;" x1="13058.7966" x2="13058.7966" y1="2589.4014" y2="2621.4014"/><polygon fill="#000000" points="13054.7966,2611.4014,13058.7966,2621.4014,13062.7966,2611.4014,13058.7966,2615.4014" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="11980.2175" x2="11980.2175" y1="2751.2451" y2="2755.2451"/><line style="stroke:#000000;stroke-width:1;" x1="11980.2175" x2="10648.2071" y1="2755.2451" y2="2755.2451"/><line style="stroke:#000000;stroke-width:1;" x1="10648.2071" x2="10648.2071" y1="2755.2451" y2="2773.2451"/><line style="stroke:#000000;stroke-width:1;" x1="10648.2071" x2="10666.2071" y1="2773.2451" y2="2773.2451"/><polygon fill="#000000" points="10656.2071,2769.2451,10666.2071,2773.2451,10656.2071,2777.2451,10660.2071,2773.2451" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="13058.7966" x2="13058.7966" y1="2751.2451" y2="2773.2451"/><line style="stroke:#000000;stroke-width:1;" x1="13058.7966" x2="10690.2071" y1="2773.2451" y2="2773.2451"/><polygon fill="#000000" points="10700.2071,2769.2451,10690.2071,2773.2451,10700.2071,2777.2451,10696.2071,2773.2451" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10467.5203" x2="10467.5203" y1="3147.4092" y2="3177.4087"/><line style="stroke:#000000;stroke-width:1;" x1="10467.5203" x2="14046.2629" y1="3177.4087" y2="3177.4087"/><line style="stroke:#000000;stroke-width:1;" x1="14046.2629" x2="14046.2629" y1="3177.4087" y2="3210.1001"/><polygon fill="#000000" points="14042.2629,3200.1001,14046.2629,3210.1001,14050.2629,3200.1001,14046.2629,3204.1001" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="14046.2629" x2="14046.2629" y1="3244.0688" y2="3276.7603"/><line style="stroke:#000000;stroke-width:1;" x1="14046.2629" x2="10467.5203" y1="3276.7603" y2="3276.7603"/><line style="stroke:#000000;stroke-width:1;" x1="10467.5203" x2="10467.5203" y1="3276.7603" y2="3305.0493"/><polygon fill="#000000" points="10463.5203,3295.0493,10467.5203,3305.0493,10471.5203,3295.0493,10467.5203,3299.0493" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10467.5203" x2="10467.5203" y1="3383.0181" y2="3388.0181"/><line style="stroke:#000000;stroke-width:1;" x1="10467.5203" x2="8098.7092" y1="3388.0181" y2="3388.0181"/><line style="stroke:#000000;stroke-width:1;" x1="8098.7092" x2="8098.7092" y1="3388.0181" y2="3403.0181"/><polygon fill="#000000" points="8094.7092,3393.0181,8098.7092,3403.0181,8102.7092,3393.0181,8098.7092,3397.0181" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="8098.7092" x2="8098.7092" y1="3436.9868" y2="3441.9868"/><line style="stroke:#000000;stroke-width:1;" x1="8098.7092" x2="6748.0149" y1="3441.9868" y2="3441.9868"/><line style="stroke:#000000;stroke-width:1;" x1="6748.0149" x2="6748.0149" y1="3441.9868" y2="3456.9868"/><polygon fill="#000000" points="6744.0149,3446.9868,6748.0149,3456.9868,6752.0149,3446.9868,6748.0149,3450.9868" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="6748.0149" x2="6748.0149" y1="3544.9243" y2="3549.9243"/><line style="stroke:#000000;stroke-width:1;" x1="6748.0149" x2="1543.7491" y1="3549.9243" y2="3549.9243"/><line style="stroke:#000000;stroke-width:1;" x1="1543.7491" x2="1543.7491" y1="3549.9243" y2="3564.9243"/><polygon fill="#000000" points="1539.7491,3554.9243,1543.7491,3564.9243,1547.7491,3554.9243,1543.7491,3558.9243" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="1543.7491" x2="1543.7491" y1="3706.8306" y2="3711.8306"/><line style="stroke:#000000;stroke-width:1;" x1="1543.7491" x2="263.5654" y1="3711.8306" y2="3711.8306"/><line style="stroke:#000000;stroke-width:1;" x1="263.5654" x2="263.5654" y1="3711.8306" y2="3726.8306"/><polygon fill="#000000" points="259.5654,3716.8306,263.5654,3726.8306,267.5654,3716.8306,263.5654,3720.8306" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="12899.8161" x2="10467.5203" y1="2817.2451" y2="2817.2451"/><line style="stroke:#000000;stroke-width:1;" x1="10467.5203" x2="10467.5203" y1="2817.2451" y2="2895.3584"/><polygon fill="#000000" points="10463.5203,2885.3584,10467.5203,2895.3584,10471.5203,2885.3584,10467.5203,2889.3584" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="13021.903" x2="13033.903" y1="2817.2451" y2="2817.2451"/><line style="stroke:#000000;stroke-width:1;" x1="13033.903" x2="13033.903" y1="2817.2451" y2="2834.2451"/><line style="stroke:#000000;stroke-width:1;" x1="13033.903" x2="10878.8938" y1="2834.2451" y2="2834.2451"/><line style="stroke:#000000;stroke-width:1;" x1="10878.8938" x2="10878.8938" y1="2834.2451" y2="2857.5264"/><polygon fill="#000000" points="10874.8938,2847.5264,10878.8938,2857.5264,10882.8938,2847.5264,10878.8938,2851.5264" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10878.8938" x2="10878.8938" y1="2891.4951" y2="3878.7681"/><line style="stroke:#000000;stroke-width:1;" x1="10878.8938" x2="10274.7172" y1="3878.7681" y2="3878.7681"/><polygon fill="#000000" points="10284.7172,3874.7681,10274.7172,3878.7681,10284.7172,3882.7681,10280.7172,3878.7681" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="10678.2071" x2="10678.2071" y1="2785.2451" y2="2790.2451"/><line style="stroke:#000000;stroke-width:1;" x1="10678.2071" x2="12960.8596" y1="2790.2451" y2="2790.2451"/><line style="stroke:#000000;stroke-width:1;" x1="12960.8596" x2="12960.8596" y1="2790.2451" y2="2805.2451"/><polygon fill="#000000" points="12956.8596,2795.2451,12960.8596,2805.2451,12964.8596,2795.2451,12960.8596,2799.2451" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="9866.4313" x2="9866.4313" y1="3924.7681" y2="3929.7681"/><line style="stroke:#000000;stroke-width:1;" x1="9866.4313" x2="7897.7736" y1="3929.7681" y2="3929.7681"/><line style="stroke:#000000;stroke-width:1;" x1="7897.7736" x2="7897.7736" y1="3929.7681" y2="3944.7681"/><polygon fill="#000000" points="7893.7736,3934.7681,7897.7736,3944.7681,7901.7736,3934.7681,7897.7736,3938.7681" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="7897.7736" x2="7897.7736" y1="3978.7368" y2="3983.7368"/><line style="stroke:#000000;stroke-width:1;" x1="7897.7736" x2="6604.0618" y1="3983.7368" y2="3983.7368"/><line style="stroke:#000000;stroke-width:1;" x1="6604.0618" x2="6604.0618" y1="3983.7368" y2="3998.7368"/><polygon fill="#000000" points="6600.0618,3988.7368,6604.0618,3998.7368,6608.0618,3988.7368,6604.0618,3992.7368" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="6604.0618" x2="6604.0618" y1="4086.6743" y2="4091.6743"/><line style="stroke:#000000;stroke-width:1;" x1="6604.0618" x2="3461.5372" y1="4091.6743" y2="4091.6743"/><line style="stroke:#000000;stroke-width:1;" x1="3461.5372" x2="3461.5372" y1="4091.6743" y2="4106.6743"/><polygon fill="#000000" points="3457.5372,4096.6743,3461.5372,4106.6743,3465.5372,4096.6743,3461.5372,4100.6743" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="3461.5372" x2="3461.5372" y1="4140.6431" y2="4145.6431"/><line style="stroke:#000000;stroke-width:1;" x1="3461.5372" x2="82.7334" y1="4145.6431" y2="4145.6431"/><line style="stroke:#000000;stroke-width:1;" x1="82.7334" x2="82.7334" y1="4145.6431" y2="4160.6431"/><polygon fill="#000000" points="78.7334,4150.6431,82.7334,4160.6431,86.7334,4150.6431,82.7334,4154.6431" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="8778.7599" x2="8778.7599" y1="2253.5264" y2="2258.5264"/><line style="stroke:#000000;stroke-width:1;" x1="8778.7599" x2="3842.7416" y1="2258.5264" y2="2258.5264"/><line style="stroke:#000000;stroke-width:1;" x1="3842.7416" x2="3842.7416" y1="2258.5264" y2="2273.5264"/><polygon fill="#000000" points="3838.7416,2263.5264,3842.7416,2273.5264,3846.7416,2263.5264,3842.7416,2267.5264" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="3842.7416" x2="3842.7416" y1="2307.4951" y2="2312.4951"/><line style="stroke:#000000;stroke-width:1;" x1="3842.7416" x2="534.1373" y1="2312.4951" y2="2312.4951"/><line style="stroke:#000000;stroke-width:1;" x1="534.1373" x2="534.1373" y1="2312.4951" y2="2327.4951"/><polygon fill="#000000" points="530.1373,2317.4951,534.1373,2327.4951,538.1373,2317.4951,534.1373,2321.4951" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="4052.7084" x2="4052.7084" y1="1642.9951" y2="1660.4951"/><line style="stroke:#000000;stroke-width:1;" x1="4052.7084" x2="744.1041" y1="1660.4951" y2="1660.4951"/><line style="stroke:#000000;stroke-width:1;" x1="744.1041" x2="744.1041" y1="1660.4951" y2="1677.9951"/><polygon fill="#000000" points="740.1041,1667.9951,744.1041,1677.9951,748.1041,1667.9951,744.1041,1671.9951" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="3539.3316" x2="3527.3316" y1="1577.0264" y2="1577.0264"/><line style="stroke:#000000;stroke-width:1;" x1="3527.3316" x2="3527.3316" y1="1577.0264" y2="1595.0264"/><line style="stroke:#000000;stroke-width:1;" x1="3527.3316" x2="4691.8099" y1="1595.0264" y2="1595.0264"/><line style="stroke:#000000;stroke-width:1;" x1="4691.8099" x2="4691.8099" y1="1595.0264" y2="1609.0264"/><polygon fill="#000000" points="4687.8099,1599.0264,4691.8099,1609.0264,4695.8099,1599.0264,4691.8099,1603.0264" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="4257.7279" x2="4257.7279" y1="1598.9951" y2="1616.4951"/><line style="stroke:#000000;stroke-width:1;" x1="4257.7279" x2="969.1236" y1="1616.4951" y2="1616.4951"/><line style="stroke:#000000;stroke-width:1;" x1="969.1236" x2="969.1236" y1="1616.4951" y2="1633.9951"/><polygon fill="#000000" points="965.1236,1623.9951,969.1236,1633.9951,973.1236,1623.9951,969.1236,1627.9951" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="2255.9439" x2="2267.9439" y1="899.5264" y2="899.5264"/><line style="stroke:#000000;stroke-width:1;" x1="2267.9439" x2="2267.9439" y1="899.5264" y2="917.5264"/><line style="stroke:#000000;stroke-width:1;" x1="2267.9439" x2="1168.5992" y1="917.5264" y2="917.5264"/><line style="stroke:#000000;stroke-width:1;" x1="1168.5992" x2="1168.5992" y1="917.5264" y2="934.6748"/><polygon fill="#000000" points="1164.5992,924.6748,1168.5992,934.6748,1172.5992,924.6748,1168.5992,928.6748" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="57.6826" x="694.3286" y="71.0625">Admin</text><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="169.8662" x="1934.4046" y="71.0625">InvoiceDetailsView</text><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="228.3838" x="2890.3514" y="71.0625">RefundModal Component</text><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="118.1602" x="3951.0182" y="71.0625">RefundModal</text><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="145.0195" x="5021.0079" y="71.0625">Vue Component</text><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="111.4629" x="5996.606" y="71.0625">Composable</text><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="112.0166" x="7089.3181" y="71.0625">invoiceStore</text><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="130.8779" x="8525.196" y="71.0625">InvoiceService</text><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="111.8057" x="10598.9696" y="71.0625">Backend API</text><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="87.583" x="12338.1338" y="71.0625">Stripe API</text><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="93.6211" x="13370.049" y="71.0625">PayPal API</text><text fill="#000000" font-family="Verdana" font-size="18" lengthAdjust="spacing" textLength="122.1855" x="14494.2075" y="71.0625">Email Service</text><!--SRC=[lLbRS-Au4dxthz2cjYg68YIPdPV0PASOOCvIDIUXW9rzsQf4s2BeZB2zban2JVBVjtKpjh6ncTqwVacmkzKNTNzgTVyarcH3KCGm3Hn11IDe7iKq4EYN7fgHLHBuQ1g77k6S1a_eCmkVqJCLQ_GLC-fZGSF0SLu7_eO6hmuNE1PExmvlwHCM18aGqM0RKeyWdmXC6Uy3yKI_6katNobvVdLw8yf1Xvsbxpkz-Hf4HNYt8Q0C3LOXyD8LSWqx0c4YuUZs5aq7az775W9B0kJk26yv21wzm9csuGmj4o720DQGtwp2Ycx8gFUjYb2__M_eOuQ6uIOA0r37C5gTO-scLHXl-XdHOKoVQ01yU1CcWJ2V9a6K2BIYXFcyfrvTM3zhklGTvk1R_UCk57IrGrx2HRWXySSoCyQ18B7LHI-5t9-lttTlRbhzF8bS6RbdKzWj2lfn4c_1esUMRBWcqY45eMVzdBjCK1ZTpqhyPVGoWKACVzHBkOy3hUAlw0eDxaP_1kRtXzlKSOTxQdcrSr0KXrlg4x-SKEdpDI75VRDFRuWPasj8ExJURiiecF8hNewNZ1IOfp69S4oC_ICiS97LXF9SX76HEI_K1Fd4xo1m53RRa1BFYK0inBxClriaueGK9PcKcEjzBCZQ6l_l5NLBf0GXx13uVIroh-NJRYz6eqo-emNXWlVQRUU0b0htdA_3XFd8YhMX2Fjyta5k2zt-YhuVC294NYBY2LSJc8ZibkXUnekCa1wwkBxgb1BeeE-XSm7AdvUGlBLQNH4krd7ux9uRdJSG-cX9bEujvv2ZcGDClf4N2cxxF_YWrWMrvXkDAGUUln8Q4x-X-Utsa14SGCRvH0P8yVi56X7knJGIT4iGYUCmHXj81Fn4U0dn6CTiPnr93HhcIQIysAefioY_3W4ibA6TLrL2Y8hdQk2epIiD0lVp1Rh44RtSNbzY2SQN9fdvPO_wbngD-uUCSwbO9NGeuP-mzqrI3QQJ4ibV013Iqp4cNXYNYT58Riu4mW1MbvHHiIkHfo2PmSxxza0ZDUwfrrBfC2CYYGFq_kfARtY_bEm8_jW7pYjjBYweULRAacxzmGV62NA3iDoYtD64jr2YIF2lzqGpRvpWaOPUKPx95H008nuXFlypIDKtNyugLwbqLht3JZ1S7xXc5ytX7PV4OdOlfePC5dfp0T116cs5qahJ7rTAAmO1fP2wF5rpj5mjsjMqlEifrWf8tZ_6wWUeh8a4wOW-lBoyT6guKaX_VtDpbFIjLQsrtZv8dYbcDGxJH4qSXYE8uOOU0ziZpBeM6OthQbtcQHaFrE-XatpL_IVE2dowQXYHFF5a5VUnUK0sIXFbizyZLJlK8VmFW8K-f-MfiyGG65eGBpkjYy_lqz5WCROwSJGVBsfvK8hI3mQTRlKETHgmsYiUEe_qLONj7knovxNyV_msdeqHzO4_pJxVgMMRtCt7imNyMTmRtHzO-CGRgElknNHCE7PCrTN4MgGA2CMiGGLS9eu7L7bvKnQqdnE0NcrEytXDhn_xZKZTVpmMDUQONJjPICbkz-lyS2nhhHEAr-YJ7F4wti1fYYgBmV8QpzHUWPHCFLN5zcjPJyXadSrQjGNPH0pYfaakosUUBFy7zurYduVuZRW_XVwkruZo0jtdMo4DkGxR8aruqhP94sBmMo3lrKlCSE2HMhwZTT89qNZ2IM2gnKJXD6oInfX-pVfrLvSo4GsNhkvhL9rYBFHacmdoczIK2lbUnme3Z3IqDDTEF5wxi130QIDRL7NQo3QUEUMH234N_PDERODeI-m_rPgHQUKTyGv1jci75-EPlVyOGVrwxcFjmUfJE8oSckhI5lEmPPGHl_Kl1t-wVCrzwKJmdEQMvVLeTe4c0KzMWEHKxg-w0JHYKZqC6nSDEC0pMYdd7w6HHgBcNogGgxuHeXf7TdUS4o53PNsk6THtVX0P3llFkKLinxvIqOeiLBbJf-68U11CA20l0c6l_AG_p2MTFzH4YEhC_h3_zvsoQWkREQZ9IbM- -anV3lXvXIkE19_jEfWAkj3NhpGZ7Vke5gRjNvwL8KUP1RaPIPuyft16sVmEQcZTQrkkgT5oacCwKBAee79jTfgKKykePFqc06weGUBURp8o3qPS5N2foJWA0pXaqXvI-da5MI17RdPMnvq3B58w6NrMaBL2PgsInCXA2sgtJJIZGUojgO12L3OKtD6abOuM7XyVnIuo7MFrncCOZk9yEY0APQ_k_Q99uPFjCNXXm4MSU010S5RHhHfCH7J8gEh6J0Rs_nRw_cPZ4FDTuA6AMKqF1SbcIM8zi-bbchcjJ6__yZ8xE77di-a-CiIQycxLTCR9BY5F0wYWcBE_KwjZ4JzZAlGwgJ7TAEJ2pGJkOqL_-kVlgIrlfb7zcBscIZNIdrRhr3VMYHNwL_b3ti9-aWHTKuAylgBipm-twAgLcuq8XMm1UKPZcHpkURxNMJwYUIiHQ8OQLg3-sHKntRYjBYF1arYZszl6ye_EIDwSxDyt6yoEZVpxBv0-ShJ8gBnss0lRXVmscxRRFNlDr3cune7F24_ZWAVKzqD5FSHolYHa3ghXl5JNb7egWLBwBtD5NqmJsPMCLzXSW2JXH1FE8pZKeDongnqIZYQIBiqVe91tIk9RMmy7GXTelf6DO5XGdP8SkH_UNI560tiDpu-90hn9BT3ZdfB14ImA6CDaXSiZMDCCEb0aQr8ZoDctI_AWj8S_FUiq5-4KXzhjwowQZKSWvO-Oob4sOABabiD4QzOXM6M6WGP4G9Mq3NFUCG2JdmTkGk_R89VCNVbgHdZ8jiG7D4cotMRP7BtkEFcEMI_Jf-aunKRSm3HAtzti6wNxOPv2Ikd5XCbUdOOOEulCO-5r9vCfEBjgLgWPEjgcouDC5pc3tTEeviXkQ0XwQiHze9UPZMh5kjfEERByHDoziJfytbh5X7lNHV-PZSTtiXQtXuNTDpTzeq4QTkmPyZhGeR4aB7nksNL-aM7mUJ1StC_sqJn-4J7KUyKv9HJnlcz2LIKm18pv01BXvg4YMxvCm_9l]--></g></svg>